<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/**
 * @var Mage_Page_Block_Html_Header $this
 */
?>

<?php
$GA_TRACK_ID = Mage::getModel('core/variable')->setStoreId(Mage::app()->getStore()->getId())->loadByCode('ga_track_id')->getValue('html');
?>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', '<?php echo $GA_TRACK_ID; ?>', 'auto');
    ga('send', 'pageview');
</script>

<!-- Hotjar Tracking Code for tekshop.vn -->
<script>
    (function (h, o, t, j, a, r) {
        h.hj = h.hj || function () {
                (h.hj.q = h.hj.q || []).push(arguments)
            };
        h._hjSettings = {hjid: 508901, hjsv: 5};
        a = o.getElementsByTagName('head')[0];
        r = o.createElement('script');
        r.async = 1;
        r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
        a.appendChild(r);
    })(window, document, '//static.hotjar.com/c/hotjar-', '.js?sv=');
</script>

<?php
$FB_APP_ID = Mage::getModel('core/variable')->loadByCode('fb_app_id')->getValue('html');
?>

<div id="fb-root"></div>
<script>(function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v2.10&appId=" + <?php echo $FB_APP_ID?>;
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>

<div class="header">
    <div class="header-container header-mobile-height">
        <div class="header-top">
            <div class="row tekshop-topbar fix-top">
                <div class="container">
                    <div class="col-md-2 col-sm-2 col-xs-2 no-padding topbar-logo">
                        <?php if ($this->getIsHomePage()): ?>
                            <div class="logo"><strong><?php echo $this->getLogoAlt() ?></strong>
                                <a href="<?php echo $this->getUrl('') ?>"
                                   title="<?php echo $this->getLogoAlt() ?>" class="logo">
                                    <img src="<?php echo $this->getSkinUrl('images/logotekshop.png') ?>"
                                         class="logo-img"
                                         alt="<?php echo $this->getLogoAlt() ?>"/>
                                </a>
                            </div>
                        <?php else: ?>
                            <div class="logo">
                                <a href="<?php echo $this->getUrl('') ?>"
                                   title="<?php echo $this->getLogoAlt() ?>"
                                   class="logo"><strong><?php echo $this->getLogoAlt() ?></strong>
                                    <img src="<?php echo $this->getSkinUrl('images/logotekshop.png') ?>"
                                         class="logo-img"
                                         alt="<?php echo $this->getLogoAlt() ?>"/>
                                </a>
                            </div>
                        <?php endif ?>
                    </div>

                    <div class="col-md-10 col-sm-10 col-xs-10 text-left no-padding topbar-search">
                        <div class="top-bar-menu text-right">
                            <?php echo $this->getChildHtml('topSearch') ?>
                        </div>
                        <div class="clearfix"></div>
                    </div>

                    <div id="shopping-cart-header">
                        <?php echo $this->getChildHtml('headerCart') ?>
                    </div>
                </div>
            </div>
            <?php echo $this->getChildHtml('topMenu') ?>
        </div>

        <?php $storeCode = Mage::app()->getStore()->getCode(); ?>
        <?php $action = Mage::app()->getFrontController()->getAction()->getFullActionName(); ?>
        <?php if ($action == 'cms_index_index'): ?>
            <div class="container slider-hotdeal-block">
                <div class="row mt-160">
                    <div class="col-xs-12 specific-cat-mobile display-flex-mobile">
                        <?php $laptopCat = Mage::getModel('catalog/category')
                            ->getCollection()
                            ->addAttributeToFilter('url_key', 'laptop')
                            ->getFirstItem(); ?>
                        <a class="specific-cat-item" href="<?php echo $laptopCat->getUrl(); ?>">
                            <img src="<?php echo $this->getSkinUrl('images/laptop.png') ?>"/>
                            <div class="cat-item-name">Laptop</div>
                        </a>
                        <?php $gearCat = Mage::getModel('catalog/category')
                            ->getCollection()
                            ->addAttributeToFilter('url_key', 'accessories')
                            ->getFirstItem(); ?>
                        <a class="specific-cat-item" href="<?php echo $gearCat->getUrl(); ?>">
                            <img src="<?php echo $this->getSkinUrl('images/phukien.png') ?>"/>
                            <div class="cat-item-name">Phụ kiện</div>
                        </a>
                        <?php $saleCat = Mage::getModel('catalog/category')
                            ->getCollection()
                            ->addAttributeToFilter('url_key', 'promotion')
                            ->getFirstItem(); ?>
                        <a class="specific-cat-item" href="<?php echo $saleCat->getUrl(); ?>">
                            <img src="<?php echo $this->getSkinUrl('images/khuyenmai.png') ?>"/>
                            <div class="cat-item-name">Khuyến mại</div>
                        </a>
                    </div>
                    <!-- New Owl Carousel-->
                    <?php
                    echo $this->getLayout()->createBlock('cms/block')->setBlockId('showcase_' . $storeCode)->toHtml();
                    ?>
                    <!-- End New Owl Carousel-->
                    <div class="hotdeal-block hidden-mobile">
                        <?php
                        echo $this->getLayout()->createBlock('cms/block')->setBlockId('hotdeal_' . $storeCode)->toHtml();
                        ?>
                    </div>
                </div>
            </div>
            <div class="row">
                <?php
                echo $this->getLayout()->createBlock('cms/block')->setBlockId('buildpc_banner_' . $storeCode)->toHtml();
                ?>
            </div>
        <?php endif; ?>

    </div>
</div>

<script>
    var $j = jQuery.noConflict();
</script>

<!--Owl carousel-->
<script>
    $j(document).ready(function () {

        var sync1 = $j("#sync1");
        var sync2 = $j("#sync2");

        sync1.owlCarousel({
            singleItem: true,
            slideSpeed: 500,
            pagination: false,
            autoPlay: true,
            navigation: true,
            navigationText: ["<i class='fa fa-chevron-left'></i>", "<i class='fa fa-chevron-right'></i>"],
            afterAction: syncPosition,
            responsiveRefreshRate: 200
        });

        sync2.owlCarousel({
            items: 5,
            itemsScaleUp: true,
            pagination: false,
            responsiveRefreshRate: 100,
            afterInit: function (el) {
                el.find(".owl-item").eq(0).addClass("synced");
            }
        });

        function syncPosition(el) {
            var current = this.currentItem;
            $j("#sync2")
                .find(".owl-item")
                .removeClass("synced")
                .eq(current)
                .addClass("synced");
            if ($j("#sync2").data("owlCarousel") !== undefined) {
                center(current)
            }
        }

        $j("#sync2").on("click", ".owl-item", function (e) {
            e.preventDefault();
            var number = $j(this).data("owlItem");
            sync1.trigger("owl.goTo", number);
        });

        function center(number) {
            var sync2visible = sync2.data("owlCarousel").owl.visibleItems;
            var num = number;
            var found = false;
            for (var i in sync2visible) {
                if (num === sync2visible[i]) {
                    var found = true;
                }
            }

            if (found === false) {
                if (num > sync2visible[sync2visible.length - 1]) {
                    sync2.trigger("owl.goTo", num - sync2visible.length + 2)
                } else {
                    if (num - 1 === -1) {
                        num = 0;
                    }
                    sync2.trigger("owl.goTo", num);
                }
            } else if (num === sync2visible[sync2visible.length - 1]) {
                sync2.trigger("owl.goTo", sync2visible[1])
            } else if (num === sync2visible[0]) {
                sync2.trigger("owl.goTo", num - 1)
            }
        }
    });
</script>
<!-- Owl carousel-->

<script>
    var win = $j(window);

    $j(window).on('resize', function () {
        var originalSearchMobileTop = 60;

        if (win.width() < 500) {
            win.scroll(function () {
                if (win.width() < 500) {
                    $j('.input-text-search').css('top', originalSearchMobileTop - win.scrollTop());
                    $j('.form-search').css('top', originalSearchMobileTop - win.scrollTop());
                }
            })
        } else {
            $j('.form-search').removeAttr('style');
            win.scroll(function () {
                $j('.nav-normal').css('top', -win.scrollTop());
                if ($j(this).scrollTop() >= 50) {
                    $j('.nav-normal').hide();
                }
                else {
                    $j('.nav-normal').show();
                }
                if (win.width() > 500 && $j(this).scrollTop() >= 60) {
                    $j('.tekshop-topbar').addClass('shrink');
                }
                else {
                    $j('.tekshop-topbar').removeClass('shrink');
                }
            })
        }
    }).trigger('resize')

    function getLastPart(url) {
        var parts = url.split("/");
        return (url.lastIndexOf('/') !== url.length - 1
            ? parts[parts.length - 1]
            : parts[parts.length - 2]);
    }
</script>
