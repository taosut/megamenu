<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/**
 * @var Mage_Page_Block_Html_Header $this
 */
?>
<?php $version = Teko::getSaleCenterVersion(); ?>
<link rel="stylesheet" type="text/css" href="<?php echo $this->getSkinUrl('lib/header.css'); ?><?php echo "?v=" . $version ?>"/>
<?php $FB_APP_ID = Mage::getModel('core/variable')->loadByCode('fb_app_id')->getValue('html'); ?>

<div id="fb-root"></div>

<script type="text/javascript">
    var responseFb = {};
    window.fbAsyncInit = function () {
        FB.init({
            appId: '<?php echo $FB_APP_ID; ?>',
            cookie: true, // enable cookies to allow the server to access the session
            xfbml: true, // parse social plugins on this page
            version: 'v2.10' // use graph api version 2.10
        });

        FB.getLoginStatus(function (response) {
            responseFb = response;
        });
    };
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/vi_VN/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    if (document.referrer) {
        if (document.referrer.search("google") > 0) {
            document.cookie = "c_utmsource=google; path=/";
        } else if (document.referrer.search("facebook") > 0) {
            document.cookie = "c_utmsource=facebook; path=/";
        }
    }

    if (navigator.userAgent.match(/Android/i)
        || navigator.userAgent.match(/webOS/i)
        || navigator.userAgent.match(/iPhone/i)
        || navigator.userAgent.match(/iPad/i)
        || navigator.userAgent.match(/iPod/i)
        || navigator.userAgent.match(/BlackBerry/i)
        || navigator.userAgent.match(/Windows Phone/i)
    ) {
        document.cookie = "_c_agent=mobile; path=/";
    }
    else {
        document.cookie = "_c_agent=desktop; path=/";
    }

    /** Save utm_campaign/source/medium to cookie (expires time 1 day) **/
    var url_string = window.location.href;
    var url = new URL(url_string);
    var utmSource = url.searchParams.get('utm_source');
    var utmMedium = url.searchParams.get('utm_medium');
    var utmCampaign = url.searchParams.get('utm_campaign');
    if (utmSource && utmSource !== '') {
        setCookie('utm_source', utmSource, 7);
    }
    if (utmMedium && utmMedium !== '') {
        setCookie('utm_medium', utmMedium, 7);
    }
    if (utmCampaign && utmCampaign !== '') {
        setCookie('utm_campaign', utmCampaign, 7);
    }
</script>

<!--Stack banner-->
<?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('stack-banner-v2')->toHtml(); ?>
<?php $session = Mage::getSingleton('customer/session'); ?>
<?php
$policiesHyperlink = json_decode(Mage::getModel('core/variable')->loadByCode('policies_hyperlink')->getValue('text'), true);
?>
<div class="header">
    <div class="header-top">
        <div class="row header-top-info-block">
            <div class="col-md-10 col-md-offset-1 pr-0 content-section">
                <div class="header-right-info">
                    <?php $headlineText = json_decode(Mage::getModel('core/variable')->loadByCode('headline_text')->getValue('text'), true); ?>
                    <a class="header-notify-text" href="<?php echo $headlineText['link']; ?>"
                       title="<?php echo $headlineText['link']; ?>">
                        <span><?php echo $headlineText['text']; ?></span>
                    </a>
                    <div class="header-right-info-content">
                        <span class="call-info">
                            <i class="fa fa-phone fa-phone-red" aria-hidden="true"></i> Tổng đài: 1900 1835
                        </span>
                        <span class="showroom-info">
                            <a class="news-link" href="<?php echo $policiesHyperlink['tin-tuc']; ?>" target="_blank">
                                <img src="<?php echo $this->getSkinUrl('images/icon_news.png'); ?>"/>
                                Tin tức & Khuyến mãi
                            </a>
                        </span>
                        <span class="showroom-info">
                            <a class="price-sheet-link" href="<?php echo $policiesHyperlink['bao-gia']; ?>">
                                Báo giá
                            </a>
                        </span>
                        <span class="showroom-info">
                            <a href="<?php echo $this->getUrl('contact'); ?>">
                                Hệ thống cửa hàng
                            </a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row header-top-main-block">
            <div class="col-md-10 col-md-offset-1 content-section">
                <div class="row">
                    <div class="col-md-1 col-sm-2">
                        <a href="<?php echo $this->getUrl('/'); ?>">
                            <img class="logo"
                                 src="<?php echo $this->getSkinUrl('images/logo.png') ?><?php echo "?v=" . $version ?>">
                        </a>
                    </div>
                    <div class="col-md-7 col-sm-6 search-block">
                        <?php echo $this->getChildHtml('topSearch') ?>
                    </div>
                    <div class="col-md-4 col-sm-4 header-right-block">
                        <div class="col-md-7 col-sm-7 header-right-login pl-0 pr-0">
                            <div class="header-right-item" <?php if (!$session->isLoggedIn()): ?>href="#loginModal"
                                 data-toggle="modal"<?php endif; ?>>
                                <img class="header-right-image"
                                     src="<?php echo $this->getSkinUrl('images/User.svg'); ?><?php echo "?v=" . $version ?>"/>
                                <div class="header-right-description">
                                    <div class="text-user"> Tài khoản <i class="fa fa-chevron-right fa-12px"
                                                                         aria-hidden="true"></i></div>
                                    <?php if (!$session->isLoggedIn()): ?>
                                        <div class="header-login-register">Đăng nhập & Đăng ký</div>
                                    <?php else: ?>
                                        <?php $name = $session->getCustomer()->getFirstname(); ?>
                                        <div class="header-username">
                                            Xin chào, <?php echo $name; ?>
                                        </div>
                                        <div class="user-info-menu">
                                            <a>Xin chào, <?php echo $name ?> </a>
                                            <a href="<?php echo $this->getUrl('tracking/order'); ?>">Kiểm tra đơn
                                                hàng</a>
                                            <a href="<?php echo $this->getUrl('favourite/index'); ?>">Sản phẩm yêu
                                                thích</a>
                                            <a href="<?php echo $this->getUrl('buildpc/saving/list'); ?>">Cấu hình của
                                                tôi</a>
                                            <!--                                    <a href="-->
                                            <?php //echo ($session->getCustomer()->getIsAgent() == '1') ? $this->getUrl('agent') : $this->getUrl('agent/index/register') ?><!--">Đặc vụ Tekshop</a>-->
                                            <a href="<?php echo Mage::getUrl('authentication/user/logout'); ?>">Đăng
                                                xuất</a>
                                        </div>
                                    <?php endif; ?>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5 col-sm-5 header-right-cart">
                            <div class="header-right-item header-cart">
                                <img class="header-right-image"
                                     src="<?php echo $this->getSkinUrl('images/icon_ShoppingCartBlack.svg'); ?>"/>
                                <div class="header-right-description">
                                    <div class="text-cart">Giỏ hàng <i class="fa fa-chevron-right fa-12px"
                                                                       aria-hidden="true"></i></div>
                                    <div class="header-cart-wrapper"
                                         id="shopping-cart-header"> <?php echo $this->getChildHtml('headerCart') ?> </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="header-navigation">
        <div class="row">
            <div class="col-md-10 col-md-offset-1 content-section">
                <div class="row">
                    <div class="col-md-2 col-sm-2 category-btn-block no-padding-right">
                        <div class="category-btn">
                            <i class="fa fa-bars"></i>
                            <span>Danh mục <span class="hidden-1200">sản phẩm</span></span>
                        </div>
                    </div>
                    <div class="col-md-10 col-sm-10 pull-right navigation-right no-padding-left">
                        <div class="col-md-5 col-sm-4 pull-left no-padding-left no-padding-right">
                            <a data-toggle="modal" data-target="#compare-list">
                                <div class="header-compare-block">
                                    <img class="left-icon-header"
                                         src="<?php echo $this->getSkinUrl('images/Compare.svg'); ?><?php echo "?v=" . $version ?>"
                                         title="So sánh sản phẩm"/>
                                    So sánh<span class="hidden-1200">&nbsp;sản phẩm</span>
                                </div>
                            </a>
                            <a href="<?php echo $this->getUrl('buildpc'); ?>"
                               target="_blank">
                                <div class="header-buildpc-block">
                                    <img class="left-icon-header"
                                         src="<?php echo $this->getSkinUrl('images/buildPC.svg'); ?><?php echo "?v=" . $version ?>"
                                         title="Xây dựng cấu hình PC"/>
                                    <span>Xây dựng cấu hình</span>
                                </div>
                            </a>
                        </div>
                        <a href="<?php echo $policiesHyperlink['bao-hanh']; ?>"
                           target="_blank">
                            <div class="warranty-block">
                                Bảo hành chính hãng
                                <img src="<?php echo $this->getSkinUrl('images/icon_Warranty.svg'); ?><?php echo "?v=" . $version ?>"
                                     title="Bảo hành chính hãng"/>
                            </div>
                        </a>
                        <a href="<?php echo $policiesHyperlink['giao-hang']; ?>"
                           target="_blank">
                            <div class="freeship-block">
                                Giao hàng miễn phí
                                <img src="<?php echo $this->getSkinUrl('images/icon_FreeShipping.svg'); ?><?php echo "?v=" . $version ?>"
                                     title="Giao hàng miễn phí"/>
                            </div>
                        </a>
                        <!--                        <a href="https://tekshop.vn/landing/chinh-sach-tra-gop.html?utm_source=website&utm_medium=header&utm_campaign=mua_hang_tra_gop"-->
                        <!--                           target="_blank">-->
                        <!--                            <div class="recurring-block">-->
                        <!--                                Hỗ trợ trả góp-->
                        <!--                                <img src="-->
                        <?php //echo $this->getSkinUrl('images/icon_InstalmentPurchase.svg'); ?><!--"-->
                        <!--                                     title="Hỗ trợ trả góp"/>-->
                        <!--                            </div>-->
                        <!--                        </a>-->
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-10 col-md-offset-1 content-section">
                <div class="row">
                    <div class="col-md-2 col-sm-3 pl-0 pr-0">
                        <div class="cat-menu">
                            <?php echo $this->getChildHtml('topMenu'); ?>
                        </div>
                    </div>
                    <div class="col-md-10 col-sm-9"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Login / register modal-->
<div id="loginModal" class="modal fade" role="dialog">
    <div class="midModalWrapper">
        <div class="modal-dialog modal-lg modal-v2">
            <!-- Modal content-->
            <div class="modal-content modal-login modal-mobile">
                <div class="modal-body modal-body-v2">
                    <button type="button" class="close-button close-lg" data-dismiss="modal" aria-hidden="true"
                            style="margin-top: -10px;">×
                    </button>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-login modal-login" style="border: none!important;">
                                <div class="panel-heading modal-login panel-heading-v2" style="border: none!important;">
                                    <div class="row" style="margin-left: 0;margin-right: 0">
                                        <div class="col-xs-4 header-item activee">
                                            <a class="lg-tabs active" id="login-form-link">Đăng nhập</a>
                                        </div>
                                        <div class="col-xs-4 header-item">
                                            <a class="lg-tabs" id="register-form-link">Đăng ký</a>
                                        </div>
                                        <div class="col-xs-4 header-item">
                                            <a class="lg-tabs" id="link-form-link">Liên kết</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body modal-login panel-login-v2">
                                    <div class="row">
                                        <div class="col-lg-12 col-lg-v2">
                                            <form id="login-form" role="form" style="display: block;">
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <!--                                                    <img src="-->
                                                        <?php //echo $this->getSkinUrl('images/logo_hv1.png') ?><!--"-->
                                                        <!--                                                         class="logo-img" alt="TekShop">-->
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center loading-login" title="Đang tải"
                                                         style="display: none">
                                                        <img src="<?php echo $this->getSkinUrl('images/loading.gif') ?><?php echo "?v=" . $version ?>">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="error-message" id="error-login"></span>
                                                    </div>
                                                </div>
                                                <div class="form-group form-tele-login">
                                                    <img src="<?php echo $this->getSkinUrl('images/id.svg') ?><?php echo "?v=" . $version ?>"/>
                                                    <input type="text" name="telephone" id="telephone-login"
                                                           tabindex="1"
                                                           class="form-control" placeholder="Số điện thoại" value=""
                                                           pattern="(\\+84|0)\\d{9,10}">
                                                </div>
                                                <div class="form-group form-password-login">
                                                    <img src="<?php echo $this->getSkinUrl('images/password.svg') ?><?php echo "?v=" . $version ?>"/>
                                                    <input type="password" name="password" id="password-login"
                                                           tabindex="2"
                                                           class="form-control" placeholder="Mật khẩu"
                                                           onkeypress="handleEnterLogin(event)">
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <button type="button" name="login-submit" id="login-submit"
                                                                    tabindex="4" class="form-control btn btn-login">
                                                                Đăng nhập
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-lg-12">
                                                            <div class="text-center">
                                                                <span style="cursor: pointer" tabindex="5"
                                                                      class="forgot-password">Quên mật khẩu?</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="strike">
                                                    <span>Hoặc đăng nhập bằng</span>
                                                </div>
                                                <div class="form-group" style="margin-top: 10px;">
                                                    <div class="row">
                                                        <div class="col-sm-8 col-sm-offset-2">
                                                            <button type="button" tabindex="4"
                                                                    class="form-control btn btn-facebook"
                                                                    onclick="checkLoginState()">
                                                                <img class="fb-image"
                                                                     src="<?php echo $this->getSkinUrl('images/facebook.svg') ?><?php echo "?v=" . $version ?>"/>
                                                                <img class="fb-image-white"
                                                                     src="<?php echo $this->getSkinUrl('images/facebook-white.svg') ?><?php echo "?v=" . $version ?>"
                                                                     style="display: none"/>
                                                                FACEBOOK
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            <form id="register-form" role="form" style="display: none;">
                                                <div class="form-group">
                                                    <div class="text-center load-register" style="display: none">
                                                        <img src="<?php echo $this->getSkinUrl('images/loading.gif') ?><?php echo "?v=" . $version ?>">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="error-message" id="error-registry"></span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <input type="text" name="email" id="register-name" tabindex="1"
                                                           class="form-control" placeholder="Họ và tên" value="">
                                                </div>
                                                <div class="form-group">
                                                    <input type="email" name="email" id="register-email" tabindex="1"
                                                           class="form-control" placeholder="Địa chỉ email" value="">
                                                </div>
                                                <div class="form-group">
                                                    <input type="text" name="telephone" id="register-telephone"
                                                           tabindex="1"
                                                           class="form-control" placeholder="Số điện thoại" value=""
                                                           pattern="(\\+84|0)\\d{9,10}">
                                                </div>
                                                <div class="form-group">
                                                    <input type="password" name="password" id="register-password"
                                                           tabindex="2" class="form-control" placeholder="Mật khẩu">
                                                </div>
                                                <div class="form-group">
                                                    <input type="password" name="confirm-password"
                                                           id="register-confirm-password" tabindex="2"
                                                           class="form-control"
                                                           placeholder="Nhập lại mật khẩu"
                                                           onkeypress="handleEnterRegister(event)">
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <button type="button" name="register-submit"
                                                                    id="register-submit" tabindex="4"
                                                                    class="form-control btn btn-register"> Đăng ký
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            <form id="link-form" role="form" style="display: none;">
                                                <div class="form-group">
                                                    <div class="text-center load-link" style="display: none">
                                                        <img src="<?php echo $this->getSkinUrl('images/loading.gif') ?><?php echo "?v=" . $version ?>">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="error-message" id="error-link"></span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="forget-text">Vui lòng nhập số điện thoại của bạn và chúng tôi sẽ gửi cho bạn một tin nhắn chứa mật khẩu. Mật khẩu có thể dùng để đăng nhập nhanh vào Phong Vũ</span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <input type="text" name="telephone" id="link-telephone" tabindex="1"
                                                           class="form-control" placeholder="Số điện thoại" value=""
                                                           onkeypress="handleEnterLink(event)"
                                                           pattern="(\\+84|0)\\d{9,10}">
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <button type="button" name="link-submit"
                                                                    id="link-submit" tabindex="4"
                                                                    class="form-control btn btn-register"> Liên kết
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="forgetPassword" class="modal fade" role="dialog">
    <div class="midModalWrapper">
        <div class="modal-dialog modal-md modal-forget">
            <div class="modal-content modal-login">
                <div class="modal-body no-padding-modal">
                    <button type="button" class="close-button close-lg" data-dismiss="modal" aria-hidden="true"
                            style="margin-top: -10px;">×
                    </button>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-login modal-login">
                                <div class="panel-heading modal-login padding-t-b-20 activee">
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <a href="#" class="active" id="forget-title">Quên mật khẩu</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body modal-login">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <form id="telephone-form" role="form" style="display: block;">
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="forget-text">Vui lòng nhập số điện thoại:</span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center load-forget" style="display: none">
                                                        <img src="<?php echo $this->getSkinUrl('images/loading.gif') ?><?php echo "?v=" . $version ?>">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="error-message" id="error-forget"></span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <input type="text" name="telephone-forget" id="telephone-forget"
                                                           tabindex="1" class="form-control" placeholder="Số điện thoại"
                                                           value=""
                                                           onkeypress='handleEnterForget(event)'>
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <button type="button" name="forget-submit"
                                                                    id="forget-submit"
                                                                    tabindex="4" class="form-control btn btn-login"> Gửi
                                                                mã
                                                                xác nhận
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            <form id="otp-form" role="form" style="display: none;">
                                                <div class="form-group">
                                                    <div class="text-center">
                                                    <span class="forget-text">Mã xác thực đã được gửi về: <span
                                                                id="forget-tele-show"></span></span>
                                                    </div>
                                                    <div class="text-center">
                                                        <span class="forget-text">Vui lòng nhập mã xác thực:</span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center load-otp1" style="display: none">
                                                        <center>
                                                            <img src="<?php echo $this->getSkinUrl('images/loading.gif') ?><?php echo "?v=" . $version ?>">
                                                        </center>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="error-message" id="error-forget-otp"></span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <input type="hidden" name="customer_id" id="customer_id_otp">
                                                    </div>
                                                </div>
                                                <div class="form-group text-center">
                                                    <input type="text" name="otp-confirm" id="otp-confirm" tabindex="1"
                                                           class="form-control" placeholder="Mã xác thực" value="">
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <div class="row">
                                                                <div class="col-sm-6">
                                                                    <button type="button" name="repassword-resend"
                                                                            id="repassword-resend" tabindex="4"
                                                                            class="form-control btn btn-login"> Gửi lại
                                                                    </button>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <button type="button" name="repassword-submit-otp"
                                                                            id="repassword-submit-otp" tabindex="4"
                                                                            class="form-control btn btn-login"> Xác nhận
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            <form id="passwordConfirmForm" role="form" style="display: none;">
                                                <div class="form-group">
                                                    <div class="text-center">
                                                    <span class="forget-text">Xin chào: <span
                                                                id="forget-name-show"></span></span>
                                                    </div>
                                                    <div class="text-center">
                                                    <span class="forget-text"><span
                                                                id="forget-email-show"></span></span>
                                                    </div>
                                                    <div class="text-center">
                                                        <span class="forget-text">Vui lòng nhập lại mật khẩu mới:</span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center load-forget-pass" style="display: none">
                                                        <img src="<?php echo $this->getSkinUrl('images/loading.gif') ?><?php echo "?v=" . $version ?>">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="error-message" id="error-reset-password"></span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <input type="hidden" name="customer_id" id="customer_id_reset">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <input type="password" name="re-password" id="re-password"
                                                           tabindex="2"
                                                           class="form-control" placeholder="Mật khẩu">
                                                </div>
                                                <div class="form-group">
                                                    <input type="password" name="re-password" id="reconfirm-password"
                                                           tabindex="2" class="form-control"
                                                           placeholder="Nhập lại mật khẩu"
                                                           onkeypress="handleEnterResetPw(event)">
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <button type="button" name="repassword-submit"
                                                                    id="repassword-submit" tabindex="4"
                                                                    class="form-control btn btn-login"> Tạo mật khẩu mới
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="linkAccountModal" class="modal fade" role="dialog">
    <div class="midModalWrapper">
        <div class="modal-dialog modal-md">
            <div class="modal-content modal-login">
                <div class="modal-body no-padding-modal">
                    <button type="button" class="close-button close-lg" data-dismiss="modal" aria-hidden="true"
                            style="margin-top: -10px;">×
                    </button>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-login modal-login">
                                <div class="panel-heading modal-login padding-t-b-20 activee">
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <a href="#" class="active" id="forget-title">Liên kết tài khoản</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body modal-login">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <form id="link-otp-form" role="form" style="display: block;">
                                                <div class="form-group">
                                                    <div class="text-center">
                                                    <span class="forget-text">Mã xác nhận đã được gửi về: <span
                                                                id="linkTele"></span></span><br>
                                                        <span class="forget-text">Vui lòng nhập mã xác nhận: </span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center load-otp2" style="display: none">
                                                        <img src="<?php echo $this->getSkinUrl('images/loading.gif') ?><?php echo "?v=" . $version ?>">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="error-message" id="error-linkAcc"></span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <input type="hidden" name="customer_id"
                                                               id="customer_id_otp_link">
                                                    </div>
                                                </div>
                                                <div class="form-group text-center">
                                                    <input type="text" name="link-otp" id="link-otp"
                                                           tabindex="1" class="form-control"
                                                           value="">
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <div class="row">
                                                                <div class="col-sm-6">
                                                                    <button type="button" name="linkAcc-resend"
                                                                            id="linkAcc-resend" tabindex="4"
                                                                            class="form-control btn btn-register"> Gửi
                                                                        lại
                                                                    </button>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <button type="button" name="linkAcc-submit-otp"
                                                                            id="linkAcc-submit-otp" tabindex="4"
                                                                            class="form-control btn btn-register"> Xác
                                                                        nhận
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            <form id="link-update-form" role="form" style="display: none;">
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="forget-text">Vui lòng cập nhật thông tin tài khoản:</span><br>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="error-message" id="error-link-update"></span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <input type="hidden" name="customer_id" id="customer_id_link">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <input type="hidden" name="linkAcc-telephone"
                                                           id="linkAcc-telephone">
                                                    <input type="text" class="form-control" name="linkAcc-name"
                                                           id="linkAcc-name" placeholder="Tên">
                                                </div>
                                                <div class="form-group">
                                                    <input type="email" class="form-control" name="linkAcc-email"
                                                           id="linkAcc-email" placeholder="Email">
                                                </div>
                                                <div class="form-group">
                                                    <input type="password" class="form-control" name="linkAcc-password"
                                                           id="linkAcc-password" placeholder="Mật khẩu">
                                                </div>
                                                <div class="form-group">
                                                    <input type="password" class="form-control"
                                                           name="linkAcc-confirmPassword" id="linkAcc-confirmPassword"
                                                           placeholder="Nhập lại mật khẩu"
                                                           onkeypress="handleEnterSubmitLink(event)">
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <button type="button" name="linkAcc-submit"
                                                                    id="linkAcc-submit" tabindex="4"
                                                                    class="form-control btn btn-register"> Cập nhật
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<div id="loginFBModal" class="modal fade" role="dialog">
    <div class="midModalWrapper">
        <div class="modal-dialog modal-md">
            <div class="modal-content modal-login">
                <div class="modal-body">
                    <button type="button" class="close-button close-lg" data-dismiss="modal" aria-hidden="true"
                            style="margin-top: -10px;">×
                    </button>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-login modal-login" style="border: none!important;">
                                <div class="panel-body modal-login">
                                    <div class="row">
                                        <div class="col-lg-12 fb-confirm-header">
                                            Xin chào, <span id="fbname"></span>
                                            <p> Vui lòng cập nhật thông tin</p>
                                        </div>
                                        <form class="fb-update-profile" id="login-form-01" role="form">
                                            <div class="form-group">
                                                <div class="text-center update-profile-load-fb" style="display: none">
                                                    <img src="<?php echo $this->getSkinUrl('images/loading.gif') ?><?php echo "?v=" . $version ?>">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="text-center">
                                                    <span class="error-message" id="error-confirm-facebook"></span>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <input type="hidden" name="registryfb-name" id="registryfb-name"
                                                       tabindex="1"
                                                       class="form-control" value="" placeholder="Tên">
                                            </div>
                                            <div class="form-group">
                                                <input type="hidden" name="facebook_id" id="inputFb" tabindex="1"
                                                       class="form-control" value="">
                                                <input type="text" name="telephone" id="fb-login-telephone" tabindex="1"
                                                       class="form-control" placeholder="Số điện thoại" value=""
                                                       onkeypress='handleLoginFb(event)'>
                                            </div>
                                            <div class="form-group">
                                                <div class="row">
                                                    <div class="col-sm-12">
                                                        <button type="button" tabindex="4"
                                                                class="form-control btn btn-login"
                                                                onclick="pushTelephoneNumber()"> Xác nhận
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                        <form id="confirm-fb-otp" role="form" style="display: none;">
                                            <div class="form-group">
                                                <div class="text-center">
                                                    <span class="forget-text">Mã xác nhận đã được gửi về: <span
                                                                id="fbOtpTele"></span></span><br>
                                                    <span class="forget-text">Vui lòng nhập mã xác nhận: </span>
                                                    <span class="fb_notice"></span>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="text-center update-otp-load-fb" style="display: none">
                                                    <img src="<?php echo $this->getSkinUrl('images/loading.gif') ?><?php echo "?v=" . $version ?>">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="text-center">
                                                    <span class="error-message" id="error-confirm-facebook-otp"></span>
                                                </div>
                                            </div>
                                            <div class="form-group text-center">
                                                <input type="hidden" name="customer_id" id="customer_id_otp_fb">
                                                <input type="hidden" name="fb_id" id="fb_id_otp">
                                                <input type="hidden" name="registryfb-otp" id="registryfb-otp"
                                                       tabindex="1"
                                                       class="form-control" value="">
                                            </div>
                                            <div class="form-group">
                                                <div class="row">
                                                    <div class="col-sm-12">
                                                        <div class="row">
                                                            <div class="col-sm-6">
                                                                <button type="button" name="loginFb-resend"
                                                                        id="loginFb-resend" tabindex="4"
                                                                        class="form-control btn btn-login"> Gửi lại
                                                                </button>
                                                            </div>
                                                            <div class="col-sm-6">
                                                                <button type="button" name="loginFb-submit-otp"
                                                                        id="loginFb-submit-otp" tabindex="4"
                                                                        class="form-control btn btn-login"> Xác nhận
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="registerModal" class="modal fade" role="dialog">
    <div class="midModalWrapper">
        <div class="modal-dialog modal-md">
            <div class="modal-content modal-login">
                <div class="modal-body no-padding-modal">
                    <button type="button" class="close-button close-lg" data-dismiss="modal" aria-hidden="true"
                            style="margin-top: -10px;">×
                    </button>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-login modal-login">
                                <div class="panel-heading modal-login activee padding-t-b-20">
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <a href="#" class="active" id="forget-title">Đăng ký</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body modal-login">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <form id="register-otp-form" role="form">
                                                <div class="form-group">
                                                    <div class="text-center">
                                                    <span class="register-text">Mã xác thực đã được gửi về: <span
                                                                id="register-tele-show"></span></span>
                                                    </div>
                                                    <div class="text-center">
                                                        <span class="register-text">Vui lòng nhập mã xác thực:</span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center load-otp-register" style="display: none">
                                                        <center>
                                                            <img src="<?php echo $this->getSkinUrl('images/loading.gif') ?><?php echo "?v=" . $version ?>">
                                                        </center>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <span class="error-message" id="error-register-otp"></span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="text-center">
                                                        <input type="hidden" name="customer_id"
                                                               id="customer_id_register">
                                                    </div>
                                                </div>
                                                <div class="form-group text-center">
                                                    <input type="text" name="otp-confirm-register"
                                                           id="otp-confirm-register"
                                                           tabindex="1" class="form-control" placeholder="Mã xác thực"
                                                           value=""/>
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <div class="row">
                                                                <div class="col-sm-6">
                                                                    <button type="button" name="register-resend"
                                                                            id="register-resend" tabindex="4"
                                                                            class="form-control btn btn-login"> Gửi lại
                                                                    </button>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <button type="button" name="registry-submit-otp"
                                                                            id="registry-submit-otp" tabindex="4"
                                                                            class="form-control btn btn-login"> Xác nhận
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--Main compare -->
<div id="compare-list" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Danh sách so sánh</h4>
            </div>
            <div class="modal-body">
                <div class="cp-panel-content row"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="detail-action-btn compare-btn hidden">
                    SO SÁNH&nbsp;&nbsp;<i class="fa fa-balance-scale"></i>
                </button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var $j = jQuery.noConflict();

    /** Enhanced Ecommerce features **/
    /** Track promotion clicks (Stack banner) **/
    $j('.stackbanner img').click(function () {
        dataLayer.push({
            'event': 'promotionClick',
            'ecommerce': {
                'promoClick': {
                    'promotions': [{
                        'id': $j(this).attr('alt'),
                        'name': $j(this).attr('alt'),
                        'position': 'Stack Banner'
                    }]
                }
            }
        });
    });
    /** End Enhanced Ecommerce features **/

    /** Stack banner functions **/
    /** Check display stack banner **/
    var timeNow = new Date().getTime();
    var motogClosed = localStorage.getItem("motog_closed");
    if (!motogClosed) {
        $j('.stackbanner').show();
    }
    else {
        if (timeNow - parseInt(motogClosed) >= 1200000) {
            $j('.stackbanner').show();
        }
        else {
            $j('.stackbanner').hide();
        }
    }

    /** Close stack banner **/
    function motogClose() {
        $j('.stackbanner').hide();
        var timeNow = new Date().getTime();
        localStorage.setItem("motog_closed", timeNow);
    }
    /** End stack banner functions **/

    /** For login **/
    $j(function () {
        $j('#login-form-link').click(function (e) {
            if ($j('#register-form-link').parent().hasClass('activee')) {
                $j("#login-form").delay(100).fadeIn(100);
                $j("#register-form").fadeOut(100);
                $j('#register-form-link').parent().removeClass('activee');
                $j(this).parent().addClass('activee');
            } else {
                $j("#login-form").delay(100).fadeIn(100);
                $j("#link-form").fadeOut(100);
                $j('#link-form-link').parent().removeClass('activee');
                $j(this).parent().addClass('activee');
            }
            e.preventDefault();
        });
        $j('#register-form-link').click(function (e) {
            if ($j('#login-form-link').parent().hasClass('activee')) {
                $j("#register-form").delay(100).fadeIn(100);
                $j("#login-form").fadeOut(100);
                $j('#login-form-link').parent().removeClass('activee');
                $j(this).parent().addClass('activee');
            } else {
                $j("#register-form").delay(100).fadeIn(100);
                $j("#link-form").fadeOut(100);
                $j('#link-form-link').parent().removeClass('activee');
                $j(this).parent().addClass('activee');
            }
            e.preventDefault();
        });
        $j('#link-form-link').click(function (e) {
            if ($j('#register-form-link').parent().hasClass('activee')) {
                $j("#link-form").delay(100).fadeIn(100);
                $j("#register-form").fadeOut(100);
                $j('#register-form-link').parent().removeClass('activee');
                $j(this).parent().addClass('activee');
            } else {
                $j("#link-form").delay(100).fadeIn(100);
                $j("#login-form").fadeOut(100);
                $j('#login-form-link').parent().removeClass('activee');
                $j(this).parent().addClass('activee');
            }
        });
    });

    function validateLoginForm() {
        var telephone = $j('#telephone-login').val();
        var password = $j('#password-login').val();
        var message = '';
        if (telephone === "" || password === "") {
            message = ("Vui lòng nhập đầy đủ các trường !");
            $j('#error-login').html(message);
            return false;
        }
        else {
            if (!/^(84|0)(1\d{9}|9\d{8}|8\d{8})$/.test(telephone)) {
                message = ("Số điện thoại không hợp lệ!");
                $j('#error-login').html(message);
                return false;
            }
            if (password.length < 8) {
                message = (" Mật khẩu không hợp lệ");
                $j('#error-login').html(message);
                return false;
            }
            $j('#error-login').html("");
            return true;
        }
    }

    function handleLogin() {
        if (validateLoginForm()) {
            var data = {
                telephone: $j('#telephone-login').val(),
                password: $j('#password-login').val()
            };
            var message = '';
            $j(".loading-login").show();
            $j.ajax({
                url: "<?php echo Mage::getUrl('authentication/user/login');?>",
                type: "post",
                dataType: 'json',
                data: data,
                success: function (response) {
                    if (response.status === "account_not_exist" || response.status === "account_not_active") {
                        message = ("Số điện thoại không tồn tại trong hệ thống!");
                        $j('#error-login').html(message);
                        $j(".loading-login").hide();
                        return false;
                    }
                    else if (response.status === "password_is_invalid") {
                        message = ("Mật khẩu không chính xác. Vui lòng nhập lại!");
                        $j('#error-login').html(message);
                        $j(".loading-login").hide();
                        return false;
                    }
                    else {
                        window.location.href =
                            '<?php echo $this->getUrl('*/*/*', ['_current' => true,
                                '_use_rewrite' => true, '_store' => Mage::app()->getStore()->getId()]); ?>';
                    }
                }
            });
        }
    }

    function handleEnterLogin(e) {
        if (e.keyCode === 13) {
            handleLogin();
            e.preventDefault(); // Ensure it is only this code that rusn
            e.stopPropagation();
        }
    }

    $j('#login-submit').on('click', function (e) {
        handleLogin();
        e.preventDefault();
        e.stopPropagation();
    });
    /** End login **/

    /** For register **/
    function validateRegistryForm() {
        var name = $j('#register-name').val();
        var email = $j('#register-email').val();
        var telephone = $j('#register-telephone').val();
        var password = $j('#register-password').val();
        var confirmPass = $j('#register-confirm-password').val();
        var message = "";
        if (email === "" || telephone === "" || password === "" || confirmPass === "" || name === "") {
            message = ("Vui lòng nhập đầy đủ các trường !");
            $j('#error-registry').html(message);
            return false;
        } else {
            if (!/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(email)) {
                message = ("Địa chỉ Email không hợp lệ!");
                $j('#error-registry').html(message);
                return false;
            }
            if (!/^(84|0)(1\d{9}|9\d{8}|8\d{8})$/.test(telephone)) {
                message = ("Số điện thoại không hợp lệ!");
                $j('#error-registry').html(message);
                return false;
            }
            if (password.length < 8) {
                message = (" Mật khẩu tối thiểu phải 8 ký tự");
                $j('#error-registry').html(message);
                return false;
            }
            if (password != confirmPass) {
                message = ("Mật khẩu nhập lại không khớp!");
                $j('#error-registry').html(message);
                return false;
            }
            $j('#error-registry').html("");
            return true;
        }
    }

    function handleRegister() {
        if (validateRegistryForm()) {
            var data = {
                telephone: $j('#register-telephone').val(),
                email: $j('#register-email').val(),
                password: $j('#register-password').val(),
                name: $j('#register-name').val()
            };
            var message = '';
            $j('.load-register').show();
            $j.ajax({
                url: "<?php echo Mage::getUrl('authentication/user/register');?>",
                type: "post",
                dataType: 'json',
                data: data,
                success: function (response) {
                    if (response.status === "account_exist") {
                        message = ("Số điện thoại đã có người sử dụng. Vui lòng nhập số điện thoại khác!");
                        $j('.load-register').hide();
                        $j('#error-registry').html(message);
                    }
                    else if (response.status === "account_fb_exist") {
                        swal({
                            title: 'Liên kết?',
                            text: "Số điện thoại đã được dùng với một tài khoản facebook khác. Bạn có muốn liên kết tài khoản không?",
                            type: 'warning',
                            showCancelButton: true,
                            confirmButtonColor: '#f7701e',
                            confirmButtonText: 'Đồng ý',
                            cancelButtonText: 'Huỷ'
                        }, function (isConfirm) {
                            if (isConfirm) {
                                var newdata = data;
                                newdata.customer_id = response.customer_id;
                                $j.ajax({
                                    url: "<?php echo Mage::getUrl('authentication/user/update');?>",
                                    type: "post",
                                    dataType: 'json',
                                    data: newdata,
                                    success: function (response) {
                                        window.location.href =
                                            '<?php echo $this->getUrl('*/*/*', ['_current' => true,
                                                '_use_rewrite' => true, '_store' => Mage::app()->getStore()->getId()]); ?>';
                                    }
                                });
                            }
                            else {
                                message = ("Vui lòng nhập số điện thoại khác!");
                                $j('.load-register').hide();
                                $j('#error-registry').html(message);
                            }
                        });
                    }
                    else if (response.status === "created" || response.status === 'account_not_active') {
                        $j('#loginModal').modal('hide');
                        $j('body').removeClass('modal-open');
                        $j('#registerModal').modal();
                        $j('#customer_id_register').val(response.customer_id);
                        $j(".load-register").hide();
                        $j('#error-registry').html("");
                        $j("#register-tele-show").html($j('#register-telephone').val());
                    }
                }
            });
        }
    }

    $j('#otp-confirm-register').pincodeInput({
        inputs: 6,
        hidedigits: false,
        complete: function (value, e, errorElement) {
            $j('#registry-submit-otp').off('click');
            // Check the OTP
            $j('#registry-submit-otp').on('click', function (event) {
                var data = {
                    'otpCode': value,
                    'customer_id': $j('#customer_id_register').val()
                };
                var message = '';
                $j('.load-otp-register').show();
                $j('#error-register-otp').html('');
                $j.ajax({
                    url: "<?php echo Mage::getUrl('authentication/otp/checkRegister');?>",
                    type: "post",
                    dataType: 'json',
                    data: data,
                    success: function (response) {
                        if (response.status === 'right_otp') {
                            // IF true
                            window.location.href =
                                '<?php echo $this->getUrl('*/*/*', ['_current' => true,
                                    '_use_rewrite' => true, '_store' => Mage::app()->getStore()->getId()]); ?>';
                        }
                        else if (response.status === 'wrong_otp') {
                            message = ("Mã xác nhận không chính xác!");
                            $j('.load-otp-register').show();
                            $j('#error-register-otp').html(message);
                        }
                    }
                });
                event.stopPropagation();
                event.preventDefault();
            })
        }
    });

    $j('#register-resend').on('click', function (e) {
        var data = {
            'customer_id': $j('#customer_id_register').val()
        };
        $j.ajax({
            url: "<?php echo Mage::getUrl('authentication/otp/resendSms');?>",
            type: "post",
            dataType: 'json',
            data: data,
            success: function (response) {
                if (response.status === 'over_sms') {
                    overSendSms();
                }
                else {
                    $j('#error-register-otp').html("");
                    return false;
                }
            }
        });
        e.preventDefault();
        e.stopPropagation();
    });

    function handleEnterRegister(e) {
        if (e.keyCode === 13) {
            handleRegister();
            e.preventDefault();
            e.stopPropagation();
        }
    }

    $j("#register-submit").on('click', function (e) {
        handleRegister();
        e.preventDefault();
        e.stopPropagation();
    });
    /** End register **/

    /** Forget password **/
    $j('.openLoginMd').on('click', function (e) {
        $j('#forgetPassword').modal('hide');
        $j('body').removeClass('modal-open');
        $j('#loginModal').modal();
    });

    $j('.forgot-password').on('click', function (e) {
        $j('#loginModal').modal('hide');
        $j('body').removeClass('modal-open');
        $j('#forgetPassword').modal();
        e.preventDefault();
        e.stopPropagation();
    });

    $j('#otp-confirm').pincodeInput({
        inputs: 6,
        hidedigits: false,
        complete: function (value, e, errorElement) {
            $j('#repassword-submit-otp').off('click');
            // Check the OTP
            $j('#repassword-submit-otp').on('click', function (event) {
                var data = {
                    'otpCode': value,
                    'customer_id': $j('#customer_id_otp').val()
                };
                var message = '';
                $j('.load-otp1').show();
                $j('#error-forget-otp').html('');
                $j.ajax({
                    url: "<?php echo Mage::getUrl('authentication/otp/check');?>",
                    type: "post",
                    dataType: 'json',
                    data: data,
                    success: function (response) {
                        if (response.status === 'right_otp') {
                            // IF true
                            $j('#customer_id_reset').val(response.customer_id);
                            $j('.load-otp1').hide();
                            $j('#otp-form').fadeOut(100);
                            $j('#forget-title').html("Nhập lại mật khẩu");
                            $j("#passwordConfirmForm").delay(100).fadeIn(100);
                        }
                        else if (response.status === 'wrong_otp') {
                            $j('.load-otp1').hide();
                            message = ("Mã xác nhận không chính xác!");
                            $j('#error-forget-otp').html(message);
                        }
                    }
                });
                event.stopPropagation();
                event.preventDefault();
            })
        }
    });

    function handleResetPw() {
        var password = $j('#re-password').val();
        var confirmPass = $j('#reconfirm-password').val();
        var customer_id = $j('#customer_id_reset').val();
        var message = '';
        if (password.length < 8) {
            message = (" Mật khẩu tối thiểu phải 8 ký tự");
            $j('#error-reset-password').html(message);
            return false;
        }
        if (password !== confirmPass) {
            message = ("Mật khẩu nhập lại không khớp!");
            $j('#error-reset-password').html(message);
            return false;
        }
        var data = {
            'password': password,
            'customer_id': customer_id
        };
        $j('.load-forget-pass').show();
        $j.ajax({
            url: "<?php echo Mage::getUrl('authentication/password/reset');?>",
            type: "post",
            dataType: 'json',
            data: data,
            success: function (response) {
                if (response.status === 'signed') {
                    window.location.href =
                        '<?php echo $this->getUrl('*/*/*', ['_current' => true,
                            '_use_rewrite' => true, '_store' => Mage::app()->getStore()->getId()]); ?>';
                }
            }
        });
    }

    function handleEnterResetPw(e) {
        if (e.keyCode === 13) {
            handleResetPw();
            e.stopPropagation();
            e.preventDefault();
            return true;
        }
    }

    $j('#repassword-submit').on('click', function (e) {
        handleResetPw();
        e.stopPropagation();
        e.preventDefault();
    });

    function handleForgetPw() {
        var telephone = $j('#telephone-forget').val();
        if (!/^(84|0)(1\d{9}|9\d{8}|8\d{8})$/.test(telephone)) {
            message = ("Số điện thoại không hợp lệ!");
            $j('#error-forget').html(message);
            return false;
        } else {
            $j('#forget-submit').prop('disable', true);
            //Send number to server
            var data = {
                'telephone': telephone
            };
            var message = '';
            $j(".load-forget").show();
            $j.ajax({
                url: "<?php echo Mage::getUrl('authentication/password/forget');?>",
                type: "post",
                dataType: 'json',
                data: data,
                success: function (response) {
                    if (response.status === 'not_exist_customer') {
                        message = ("Số điện thoại không có trong hệ thống!");
                        $j(".load-forget").hide();
                        $j('#error-forget').html(message);
                        $j('#forget-submit').prop('disable', false);
                        return false;
                    }
                    else if (response.status === 'true') {
                        $j('#customer_id_otp').val(response.customer_id);
                        $j(".load-forget").hide();
                        $j('#error-forget').html("");
                        $j("#otp-form").delay(100).fadeIn(100);
                        $j("#forget-tele-show").html(telephone);
                        $j('#forget-name-show').html(response.name);
                        $j("#telephone-form").fadeOut(100);
                    }
                    else {
                        overSendSms();
                    }
                }
            });
        }
    }

    function handleEnterForget(e) {
        if (e.keyCode === 13) {
            handleForgetPw();
            e.stopPropagation();
            e.preventDefault();
        }
    }

    $j('#forget-submit').on('click', function (e) {
        handleForgetPw();
        e.stopPropagation();
        e.preventDefault();
    });
    /** End forget password **/

    /** For link accout **/
    function handleLink() {
        var telephone = $j('#link-telephone').val();
        var message = '';
        if (!/^(84|0)(1\d{9}|9\d{8}|8\d{8})$/.test(telephone)) {
            message = ("Số điện thoại không hợp lệ!");
            $j('#error-link').html(message);
            return false;
        } else {
            // Check telephone
            var data = {
                'telephone': telephone
            };
            $j('.load-link').show();
            $j.ajax({
                url: "<?php echo Mage::getUrl('authentication/linked/index');?>",
                type: "post",
                dataType: 'json',
                data: data,
                success: function (response) {
                    if (response.status === 'order_not_exist') {
                        message = ("Số điện thoại không có đơn hàng nào trong hệ thống!");
                        $j('.load-link').hide();
                        $j('#error-link').html(message);
                        $j('#link-submit').prop('disabled', false);
                        return false;
                    }
                    else if (response.status === 'phone_exist') {
                        message = ("Số điện thoại có người sử dụng!");
                        $j('.load-link').hide();
                        $j('#error-link').html(message);
                        $j('#link-submit').prop('disabled', false);
                        return false;
                    }
                    else if (response.status === 'phone_linked') {
                        message = ("Số điện thoại đã được sử dụng để liên kết!");
                        $j('.load-link').hide();
                        $j('#error-link').html(message);
                        $j('#link-submit').prop('disabled', false);
                        return false;
                    }
                    else if (response.status === 'allow_link' || response.status === 'not_active') {
                        // If telephone existed
                        $j('#customer_id_otp_link').val(response.customer_id);
                        $j('#loginModal').modal('hide');
                        $j('body').removeClass('modal-open');
                        $j('#linkTele').html(telephone);
                        $j("#linkAcc-telephone").val(telephone);
                        $j('.load-link').hide();
                        $j('#link-submit').prop('disabled', false);
                        if (!$j("#link-otp-form").is(":visible")) {
                            $j("#link-update-form").fadeOut(100);
                            $j('#link-otp-form').fadeIn(100);
                        }
                        $j('#linkAccountModal').modal();
                    }
                }
            });
        }
    }

    function handleEnterLink(event) {
        if (event.keyCode === 13) {
            handleLink();
            event.preventDefault();
            event.stopPropagation();
            return true;
        }
    }

    $j('#link-submit').on('click', function (e) {
        handleLink();
        e.preventDefault();
        e.stopPropagation();
    });

    $j('#link-otp').pincodeInput({
        inputs: 6,
        hidedigits: false,
        complete: function (value, e, errorElement) {
            $j('#linkAcc-submit-otp').off('click');
            // Check the OTP
            $j('#linkAcc-submit-otp').on('click', function (event) {
                var message = '';
                $j('#error-linkAcc').html(message);
                var data = {
                    'otpCode': value,
                    'customer_id': $j('#customer_id_otp_link').val()
                };

                $j.ajax({
                    url: "<?php echo Mage::getUrl('authentication/otp/check');?>",
                    type: "post",
                    dataType: 'json',
                    data: data,
                    success: function (response) {
                        if (response.status === 'right_otp') {
                            // IF true
                            $j('#customer_id_link').val(response.customer_id);
                            $j("#link-otp-form").fadeOut(100);
                            $j('#link-update-form').delay(100).fadeIn(100);
                        }
                        else {
                            message = ("Mã xác nhận không chính xác!");
                            $j('#error-linkAcc').html(message);
                        }
                    }
                });
                event.preventDefault();
                event.stopPropagation();
            })
        }
    });

    function handleSubmitLink() {
        var name = $j("#linkAcc-name").val();
        var password = $j("#linkAcc-password").val();
        var confirmPassword = $j('#linkAcc-confirmPassword').val();
        var telephone = $j("#linkAcc-telephone").val();
        var email = $j('#linkAcc-email').val();
        var message = "";
        if (name && email) {
            if (!/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(email)) {
                message = ("Địa chỉ Email không hợp lệ!");
                $j('.load-otp2').hide();
                $j('#error-link-update').html(message);
                return false;
            }
            if (password.length < 8) {
                message = (" Mật khẩu tối thiểu phải 8 ký tự");
                $j('.load-otp2').hide();
                $j('#error-link-update').html(message);
                return false;
            }
            if (password !== confirmPassword) {
                message = ("Mật khẩu nhập lại không khớp!");
                $j('.load-otp2').hide();
                $j('#error-link-update').html(message);
                return false;
            }
            // Update Information
            var data = {
                'name': name,
                'password': password,
                'email': email,
                'telephone': telephone,
                'customer_id': $j('#customer_id_link').val()
            };
            $j('.load-otp2').show();
            $j.ajax({
                url: "<?php echo Mage::getUrl('authentication/user/update');?>",
                type: "post",
                dataType: 'json',
                data: data,
                success: function (response) {
                    window.location.href =
                        '<?php echo $this->getUrl('*/*/*', ['_current' => true,
                            '_use_rewrite' => true, '_store' => Mage::app()->getStore()->getId()]); ?>';
                }
            });
        } else {
            message = "Vui lòng nhập đầy đủ các trường";
            $j('.load-otp2').hide();
            $j("#error-link-update").html(message);
        }
    }

    function handleEnterSubmitLink(event) {
        if (event.keyCode === 13) {
            handleSubmitLink();
            event.preventDefault();
            event.stopPropagation();
            return true;
        }
    }

    $j('#linkAcc-submit').on('click', function (e) {
        handleSubmitLink();
        e.preventDefault();
        e.stopPropagation();
    });

    $j('#linkAcc-resend').on('click', function (e) {
        var data = {
            'customer_id': $j('#customer_id_otp_link').val()
        };
        $j.ajax({
            url: "<?php echo Mage::getUrl('authentication/otp/resendSms');?>",
            type: "post",
            dataType: 'json',
            data: data,
            success: function (response) {
                if (response.status === 'over_sms') {
                    overSendSms();
                }
                else {
                    $j('#error-linkAcc').html("");
                    return false;
                }
            }
        });
        e.preventDefault();
        e.stopPropagation();
    });
    /** End link accout **/

    /** For login Facebook **/
    function otpForFB(id, name) {
        $j('#loginModal').modal('hide');
        $j('body').removeClass('modal-open');
        $j('#fbname').html(name);
        $j('#inputFb').val(id);
        $j('#registryfb-name').val(name);
        $j('#loginModal').toggle();
        $j('#loginFBModal').modal();
    }

    function checkLoginState() {
        if (responseFb.status === 'connected') {
            FB.api('/me', {fields: 'id, name'}, function (response) {
                var data = {
                    'fbid': response.id
                };
                $j.ajax({
                    url: "<?php echo Mage::getUrl('authentication/facebook/login');?>",
                    type: "post",
                    dataType: 'json',
                    data: data,
                    success: function (response_ajax) {
                        if (response_ajax.status === 'email_is_not_exist' ||
                            response_ajax.status === 'phone_not_active') {
                            otpForFB(response.id, response.name);
                        }
                        else {
                            window.location.href =
                                '<?php echo $this->getUrl('*/*/*', ['_current' => true,
                                    '_use_rewrite' => true, '_store' => Mage::app()->getStore()->getId()]); ?>';
                        }
                    }
                });
            });
        }
        else {
            FB.login(function (response_login) {
                if (response_login.status === 'connected') {
                    FB.api('/me', {fields: 'id, name'}, function (response) {
                        var data = {
                            'fbid': response.id
                        };
                        $j.ajax({
                            url: "<?php echo Mage::getUrl('authentication/facebook/checkRegister');?>",
                            type: "post",
                            dataType: 'json',
                            data: data,
                            success: function (response_ajax) {
                                if (response_ajax.status === 'exist') {
                                    $j.ajax({
                                        url: "<?php echo Mage::getUrl('authentication/facebook/login');?>",
                                        type: "post",
                                        dataType: 'json',
                                        data: data,
                                        success: function (response_ajax) {
                                            if (response_ajax.status === 'email_is_not_exist' ||
                                                response_ajax.status === 'phone_not_active') {
                                                otpForFB(response.id, response.name);
                                            }
                                            else {
                                                window.location.href =
                                                    '<?php echo $this->getUrl('*/*/*', ['_current' => true,
                                                        '_use_rewrite' => true, '_store' => Mage::app()->getStore()->getId()]); ?>';
                                            }
                                        }
                                    });
                                }
                                else {
                                    var name = response.name;
                                    var id = response.id;
                                    otpForFB(id, name);
                                }
                            }
                        });
                    });
                }
            }, {scope: 'public_profile, email'});
        }
    }

    function handleLoginFb(event) {
        if (event.keyCode === 13) {
            pushTelephoneNumber();
            event.preventDefault();
            event.stopPropagation();
            return true;
        }
    }

    // Validate the form
    function pushTelephoneNumber() {
        var telephone = $j('#fb-login-telephone').val();
        var name = $j('#registryfb-name').val();
        var message = '';
        if (telephone) {
            if (!/^(84|0)(1\d{9}|9\d{8}|8\d{8})$/.test(telephone)) {
                message = ("Số điện thoại không hợp lệ!");
                $j('#error-confirm-facebook').html(message);
                return false;
            }
            else {
                var id = $j('#inputFb').val();
                var data = {
                    'fbid': id,
                    'telephone': telephone,
                    'name': name
                };
                $j('.update-profile-load').show();
                $j.ajax({
                    url: "<?php echo Mage::getUrl('authentication/facebook/register');?>",
                    type: "post",
                    dataType: 'json',
                    data: data,
                    success: function (response) {
                        if (response.status === "phone_existed") {
                            message = ("Số điện thoại đã có người sử dụng. Vui lòng nhập số điện thoại khác!");
                            $j('.update-profile-load-fb').hide();
                            $j('#error-confirm-facebook').html(message);
                        }
                        else if (response.status === "over_sms") {
                            overSendSms();
                        }
                        else {
                            $j('.fb-confirm-header').html('');
                            $j('#fbOtpTele').html(telephone);
                            $j('#customer_id_otp_fb').val(response.customer_id);
                            $j('#fb_id_otp').val(id);
                            $j('.fb-update-profile').fadeOut(100);
                            $j("#confirm-fb-otp").delay(100).fadeIn(100);
                        }

                    }
                });
            }
        } else {
            message = "Vui lòng nhập đầy đủ các trường";
            $j('#error-confirm-facebook').html(message);
            return false;
        }
    }

    $j('#registryfb-otp').pincodeInput({
        inputs: 6,
        hidedigits: false,
        complete: function (value, e, errorElement) {
            $j('#loginFb-submit-otp').off('click');
            // Check the OTP
            $j('#loginFb-submit-otp').on('click', function () {
                var data = {
                    'otpCode': value,
                    'customer_id': $j('#customer_id_otp_fb').val(),
                    'fb_id': $j('#fb_id_otp').val()
                };
                var message = '';
                $j.ajax({
                    url: "<?php echo Mage::getUrl('authentication/otp/checkAndLogin');?>",
                    type: "post",
                    dataType: 'json',
                    data: data,
                    success: function (response) {
                        if (response.status === 'right_otp') {
                            window.location.href =
                                '<?php echo $this->getUrl('*/*/*', ['_current' => true,
                                    '_use_rewrite' => true, '_store' => Mage::app()->getStore()->getId()]); ?>';
                        }
                        else {
                            message = ("Mã xác nhận không chính xác!");
                            $j('#error-confirm-facebook-otp').html(message);
                        }
                    }
                });
            });
        }
    });

    $j('#loginFb-resend').on('click', function (e) {
        var data = {
            'customer_id': $j('#customer_id_otp_fb').val()
        };
        $j.ajax({
            url: "<?php echo Mage::getUrl('authentication/otp/resendSms');?>",
            type: "post",
            dataType: 'json',
            data: data,
            success: function (response) {
                if (response.status === 'over_sms') {
                    overSendSms();
                }
                else {
                    $j('#error-confirm-facebook').html("");
                    return false;
                }
            }
        });
        e.preventDefault();
        e.stopPropagation();
    });
    /** End login Facebook **/

    function overSendSms() {
        swal({
            title: "Bạn cần được hỗ trợ",
            text: "Nếu bạn vẫn chưa nhận được mã xác nhận, vui lòng liên hệ tổng đài <b>19001232</b> để được hỗ trợ!",
            type: "warning",
            showCancelButton: false,
            showConfirmButton: true,
            confirmButtonColor: "#f7701e",
            confirmButtonText: "Đóng",
            closeOnConfirm: false,
            animation: "slide-from-top",
            html: true
        }, function (isConfirm) {
            if (isConfirm) {
                window.location.href =
                    '<?php echo $this->getUrl('*/*/*', ['_current' => true,
                        '_use_rewrite' => true, '_store' => Mage::app()->getStore()->getId()]); ?>';
            }
        });
    }
    $j(document).ready(function () {
        if ($j('.compare-checkbox').length) {
            $j('.header-compare-block').show();
        }
    });
</script>
